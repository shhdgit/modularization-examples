<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/modularization_examples/styles.a7965b94cc071282aad0.css">.popover{position:relative;max-width:16rem;box-shadow:0 10px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05);padding:1rem;border:1px solid var(--separator);border-radius:.5rem;background-color:var(--references-bg);max-height:16rem;overflow:hidden}.popover.no-max-width{max-width:90vw}.popover.with-markdown{font-size:.875rem}.popover h1{margin:0;padding:0;font-size:1rem}.popover ul{padding-left:1rem}.popover .more-content-blind{height:4rem;position:absolute;background:transparent;background:linear-gradient(0,var(--references-bg),var(--references-bg-80) 50%,var(--references-bg-0));top:12rem;width:100%;left:0}.tippy-box[data-animation=shift-away][data-state=hidden]{opacity:0}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=top]{-webkit-transform:translateY(10px);transform:translateY(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=bottom]{-webkit-transform:translateY(-10px);transform:translateY(-10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=left]{-webkit-transform:translateX(10px);transform:translateX(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=right]{-webkit-transform:translateX(-10px);transform:translateX(-10px)}.reference{text-decoration:none}.reference:hover{color:var(--references-highlight)}.reference>div{padding-top:.5rem;padding-bottom:.5rem}.reference>div>p{margin:0;font-size:.875rem}.reference>div>ul{margin:0}.references-block{color:var(--references-text);padding:1rem;margin:1rem 0;border-radius:.5rem;background-color:var(--references-bg);transition:background-color .3s ease,color .3s ease}.references-block>div{margin-bottom:1rem}.references-block>hr{margin-left:auto;margin-right:auto;width:8rem}.references-block a{color:var(--references-text);transition:color .3s ease}.references-block>p:last-child{margin-bottom:0}.note-container{background:var(--note-bg);transition:background .3s ease}.note-container:first-child{border-left:none}.note-container .note-content,.note-container .obstructed-label{transition:opacity 75ms linear}.note-container .obstructed-label{display:block;color:var(--text);text-decoration:none;font-size:17px;line-height:40px;font-weight:500;-webkit-writing-mode:vertical-lr;-ms-writing-mode:tb-lr;writing-mode:vertical-lr;-webkit-text-orientation:sideways;text-orientation:sideways;margin-top:36px;top:0;bottom:0;left:0;position:absolute;background-color:transparent;width:40px;overflow:hidden;opacity:0;transition:color .3s ease;pointer-events:none}.note-container.note-container-highlighted{background:var(--references-bg);transition:background .3s ease}.note-content img{max-width:100%}@media screen and (max-width:800px){.note-container{padding:16px;width:100%;overflow-y:auto}}@media screen and (min-width:801px){.note-container{transition:box-shadow .1s linear,opacity 75ms linear,-webkit-transform .2s cubic-bezier(.19,1,.22,1);transition:box-shadow .1s linear,opacity 75ms linear,transform .2s cubic-bezier(.19,1,.22,1);transition:box-shadow .1s linear,opacity 75ms linear,transform .2s cubic-bezier(.19,1,.22,1),-webkit-transform .2s cubic-bezier(.19,1,.22,1);flex-shrink:0;width:625px;max-width:625px;top:0;position:sticky;flex-grow:1;border-left:1px solid var(--separator);padding:0}.note-content{overflow-y:auto;height:100%;padding:32px}.note-container-overlay{box-shadow:0 0 15px 3px var(--shadow)}.note-container-obstructed .note-content{opacity:0}.note-container-obstructed .obstructed-label{opacity:1;pointer-events:all}}.dark-mode-toggle{cursor:pointer;-webkit-transform:scale(.6);transform:scale(.6)}.dark-mode-toggle input{display:none}.dark-mode-toggle input+div{border-radius:50%;width:36px;height:36px;position:relative;box-shadow:inset 16px -16px 0 0 #fff;-webkit-transform:scale(1) rotate(-2deg);transform:scale(1) rotate(-2deg);transition:box-shadow .5s ease 0s,-webkit-transform .4s ease .1s;transition:box-shadow .5s ease 0s,transform .4s ease .1s;transition:box-shadow .5s ease 0s,transform .4s ease .1s,-webkit-transform .4s ease .1s}.dark-mode-toggle input+div:before{content:"";width:inherit;height:inherit;border-radius:inherit;position:absolute;left:0;top:0;transition:background .3s ease}.dark-mode-toggle input+div:after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--link),0 23px 0 var(--link),23px 0 0 var(--link),-23px 0 0 var(--link),15px 15px 0 var(--link),-15px 15px 0 var(--link),15px -15px 0 var(--link),-15px -15px 0 var(--link);-webkit-transform:scale(0);transform:scale(0);transition:all .3s ease}.dark-mode-toggle input:checked+div{box-shadow:inset 32px -32px 0 0 #fff;-webkit-transform:scale(.5) rotate(0deg);transform:scale(.5) rotate(0deg);transition:box-shadow .2s ease 0s,-webkit-transform .3s ease .1s;transition:transform .3s ease .1s,box-shadow .2s ease 0s;transition:transform .3s ease .1s,box-shadow .2s ease 0s,-webkit-transform .3s ease .1s}.dark-mode-toggle input:checked+:before{background:var(--link);transition:background .3s ease .1s}.dark-mode-toggle input:checked+:after{-webkit-transform:scale(1.5);transform:scale(1.5);transition:-webkit-transform .5s ease .15s;transition:transform .5s ease .15s;transition:transform .5s ease .15s,-webkit-transform .5s ease .15s}.graph-button{border:0;background:none;cursor:pointer}.graph-button svg g{stroke:var(--link)}.searchWrapper{position:relative;display:block}.inputWrapper{position:relative;color:var(--text)}.inputWrapper .searchIcon{position:absolute;fill:var(--link);left:2px;height:34px;padding:2px 2px 0;pointer-events:none}.inputWrapper input{color:var(--text);font-size:1rem;border:none;height:36px;padding-left:28px;background-color:var(--note-bg);transition:all .3s ease-in-out;width:28px}.inputWrapper input:focus{outline:none;width:100%}.results{-webkit-padding-start:0;padding-inline-start:0;position:absolute;display:block;top:100%;right:0;width:500px;max-height:50vh;background:var(--note-bg);box-shadow:-5px -5px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05);overflow-y:auto;border-radius:8px}.results li{display:block;text-decoration:none;cursor:pointer;padding:16px 24px;border-bottom:1px solid var(--separator)}.results li:hover{background:var(--references-bg)}.results li .title{color:var(--text)}.results li .excerpt{color:var(--references-text)}@media screen and (max-width:600px){.results{right:-85px;width:calc(100vw - 40px)}}.lds-dual-ring:after{content:" ";left:calc(50% - 32px);position:relative;display:block;width:64px;height:64px;margin:8px;border-radius:50%;border-color:var(--separator);border-left:6px solid transparent;border-bottom:6px solid var(--separator);border-right:6px solid transparent;border-top:6px solid var(--separator);-webkit-animation:lds-dual-ring 1.2s ease-in-out infinite;animation:lds-dual-ring 1.2s ease-in-out infinite}@-webkit-keyframes lds-dual-ring{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes lds-dual-ring{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}header{width:100%;min-height:57px;z-index:5;background-color:var(--note-bg);border-bottom:1px solid var(--separator);display:flex;justify-content:space-between;align-items:center;padding:10px 32px;flex-wrap:wrap;transition:background-color .3s ease}header>a{font-weight:700;color:var(--text);text-decoration:none;transition:color .3s ease}header .controls{display:flex}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body.light-mode{--main-bg:#fafafc;--note-bg:#fff;--text:#1a202c;--separator:#e2e8f0;--shadow:rgba(0,0,0,0.1);--link:#3182ce;--references-bg:#ebf4ff;--references-bg-80:rgba(235,244,255,0.8);--references-bg-0:rgba(235,244,255,0);--references-text:#718096;--references-highlight:#4a5568}body.dark-mode{--main-bg:#000;--note-bg:#0a0d11;--text:#fafafc;--separator:#252525;--shadow:hsla(0,0%,100%,0.1);--link:#3da1ff;--references-bg:#17181a;--references-bg-80:rgba(23,24,26,0.8);--references-bg-0:rgba(23,24,26,0);--references-text:#8c9fbb;--references-highlight:#b3cbf0}body{background-color:var(--main-bg);color:var(--text);margin:0;padding:0;height:100vh;transition:background-color .3s ease,color .3s ease}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}pre{white-space:pre-wrap}*,:after,:before{box-sizing:border-box}h1,h2,h3{font-weight:700}hr{margin-top:1rem;margin-bottom:1rem;border:solid var(--separator);border-width:1px 0 0;box-sizing:content-box;height:0;overflow:visible}a{color:var(--link);text-decoration:underline;transition:color .3s ease}a:hover{text-decoration:none}h1{font-size:1.875rem;margin-top:1rem}h1,p{margin-bottom:1rem}.layout{height:100vh;display:flex;flex-direction:column}.note-columns-scrolling-container{display:flex;overflow-x:auto;overflow-y:hidden;flex-grow:1}.note-columns-container{display:flex;flex-grow:1;transition:width .1s cubic-bezier(.19,1,.22,1)}@media screen and (max-width:800px){.note-columns-container{width:unset!important}}.overlay{z-index:98;position:fixed;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;height:100%;width:100%;background-color:var(--shadow);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal{z-index:99;position:fixed;border-radius:8px;background-color:var(--main-bg);box-shadow:-5px -5px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05)}.modal-close,.modal-scale{position:absolute;top:0;right:0;padding:5px;border:0;background:none;color:var(--text);cursor:pointer}.modal-close svg,.modal-scale svg{width:20px;height:20px}.modal-close path,.modal-scale path{fill:currentColor}.modal-scale{right:30px}.modal-minimized .modal-close svg,.modal-minimized .modal-scale svg{width:15px;height:15px}.modal-minimized .modal-scale{right:25px}.modal-body{height:100%;width:100%}.modal-body .node,.modal-body .text{cursor:pointer}</style><meta name="generator" content="Gatsby 2.24.67"/><link as="script" rel="preload" href="/modularization_examples/component---node-modules-gatsby-theme-gardenx-src-templates-local-file-js-dcc791b43f566c1a08be.js"/><link as="script" rel="preload" href="/modularization_examples/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/modularization_examples/app-3ebb7bf766e9c9328de5.js"/><link as="script" rel="preload" href="/modularization_examples/framework-e87d450386191ab2f570.js"/><link as="script" rel="preload" href="/modularization_examples/webpack-runtime-6966da674d0f80bafab7.js"/><link as="fetch" rel="preload" href="/modularization_examples/page-data/public/142388d4e5a02585151e424aef5c7488/README/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/modularization_examples/page-data/sq/d/2098632890.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/modularization_examples/page-data/sq/d/2221750479.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/modularization_examples/page-data/sq/d/2468095761.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/modularization_examples/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><header><a href="/modularization_examples/"><h3>业务逻辑拆分模式</h3></a><div class="controls"><div class="searchWrapper" role="combobox" aria-expanded="false" aria-haspopup="listbox" aria-labelledby="downshift-56-label"><div class="inputWrapper"><svg class="searchIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23.111 20.058l-4.977-4.977c.965-1.52 1.523-3.322 1.523-5.251 0-5.42-4.409-9.83-9.829-9.83-5.42 0-9.828 4.41-9.828 9.83s4.408 9.83 9.829 9.83c1.834 0 3.552-.505 5.022-1.383l5.021 5.021c2.144 2.141 5.384-1.096 3.239-3.24zm-20.064-10.228c0-3.739 3.043-6.782 6.782-6.782s6.782 3.042 6.782 6.782-3.043 6.782-6.782 6.782-6.782-3.043-6.782-6.782z"></path></svg><input type="text" aria-autocomplete="list" aria-labelledby="downshift-56-label" autoComplete="off" value="" id="downshift-56-input" placeholder="Search..."/></div></div><button title="Show Graph visualisation" aria-label="Show Graph visualisation" class="graph-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20"><g fill="none" stroke-width="2"><circle cx="11.733" cy="3.181" r="1.902"></circle><circle cx="16.864" cy="10.861" r="1.902"></circle><circle cx="7.47" cy="16.822" r="1.902"></circle><circle cx="3.046" cy="6.275" r="1.902"></circle><circle cx="9.372" cy="10.861" r="1.902"></circle><line x1="11.635" x2="14.655" y1="10.861" y2="10.861"></line><line x1="10" x2="10.895" y1="8.959" y2="5.573"></line><line x1="7.47" x2="4.5" y1="9.68" y2="7.5"></line><line x1="8.25" x2="8.809" y1="14.92" y2="13.088"></line></g></svg></button><label class="dark-mode-toggle" aria-label="Activate dark mode" title="Activate dark mode"><input type="checkbox" checked=""/><div></div></label></div></header><div class="note-columns-scrolling-container"><div class="note-columns-container" style="width:1250px"><div class="note-container   " style="left:0;right:-585px"><div class="note-content"><h1 id="装配逻辑">装配逻辑</h1><p>最理想的拆分后又组合的方式是“粘贴”到一起。就像你把一块砖，劈开了。拼装回去就是把两半又放一起。也就是我们可以有一个通用的函数 integrate(comp1, comp2, .. compN)。很多组件化系统都是这么吹捧自己的，比如说父类与子类，最终拼装出结果，这个拼装就是继承规则。比如说 OSGi，一堆 bundle，不用管他们是什么，都可以用同样的方式拼装起来。然而，我们都知道业务逻辑拆分出 git 仓库之后，往往是没有办法用通用的函数组合回去的。</p><p>比如说我们需要描述两个模块提供的按钮，哪个在哪个的左边。比如说我们要拼装两条促销规则，要说明哪个用了之后哪个就不能用了。这些业务上的空间组合，时间组合是必不可少的。</p><p>任何向你推销通用的组合式组件系统的人，最终都会搞出一个配置文件给你写“装配逻辑”。这样的模块装配文件就是没事找事，本来可以用大家都懂的 javascript 解决的问题，要变成用 XML 换了花来写。</p><h2 id="文件做集成">文件做“集成”</h2><p>业务逻辑会拆分成</p><ul><li>文件</li><li>文件夹</li><li>Git 仓库</li></ul><p>Git 仓库负责了拆分。文件的作用就是“集成”。比如最最常用的方式</p><pre><code class="language-ts">function functionA() {
    funcitonB();
    functionC();
}
</code></pre><p>我们把 functionA 放在 A 中，functionB 和 functionC 放在 B/C 中。这就是最常用的“编排”集成方式。通过把它们放在一个文件中，我们声明了 functionB 要发生在 functionC 之前，说明了时间上的顺序规则。</p><p>如果我们用的是 React 写界面，可以声明</p><pre><code class="language-ts">function functionA() {
    return &lt;ul&gt;&lt;li&gt;&lt;functionB/&gt;&lt;/li&gt;&lt;li&gt;&lt;functionC/&gt;&lt;/li&gt;&lt;/ul&gt;
}
</code></pre><p>这个就说明了在界面上，functionB 要放在 functionC 的上一行。通过一个文件，说明了空间上的顺序规则。
这也说明了文件的主要意义，它是用来把逻辑<strong>在时间和空间上做集成</strong>的。
说明在空间上，多个Git仓库是如何组合的，哪个在左哪个在右。
说明在时间上，多个Git仓库是互相交互的，哪个在前哪个在后。</p><p>如果两行代码，写在同一个文件，和写两个文件里，没有啥区别。
那说明这两行代码没有必要强行塞到同一个文件里。比如你写了一个 User.ts，有用户可以发招租的界面样式代码，也有用户买外卖的处理过程代码。
这些没有强烈时空上集成规则的两个东西都强行塞到 User.ts 里，实际上就没有利用好“文件”的特殊性质，是对稀缺注意力资源的浪费。</p><p>我们如果拆出了 B 和 C 这两个 Git 仓库。理论上只有两种把 B 和 C 集成起来的办法。</p><h2 id="装配逻辑放顶上：顶层编排">装配逻辑放顶上：顶层编排</h2><p>引入一个 A 仓库，它依赖了 B 和 C。</p><p><img src="./DependencyInversion-1.drawio.svg" alt="orchestration"/></p><p>集成&quot;文件&quot;定义在依赖的最顶层里。</p><h2 id="装配逻辑放底下：依赖倒置">装配逻辑放底下：依赖倒置</h2><p>引入一个 A 仓库，提供接口。由 B 和 C 实现这个接口，插入到 A 上。就像主板和显卡那样，A 就是主板，B 和 C 就是显卡。</p><p><img src="./DependencyInversion-2.drawio.svg" alt="motherboard"/></p><p>在 B 和 C 上面还需要一个仓库 D 把大家都包括进去，但是这个仓库里可以没有业务逻辑了。
集成&quot;文件&quot;定义在依赖的最底层。</p><p>不清楚 A/B/C/D 都是啥没关系。下面我们来看一些代码，然后就应该明白了。</p><h1 id="如何实现依赖倒置？">如何实现依赖倒置？</h1><p>要实现依赖倒置有运行时和编译时两大类做法，无数种具体实现。这里列举几种代表性的。</p><h2 id="运行时：组合函数">运行时：组合函数</h2><p>以 TypeScript 示例。</p><p>我们可以在 A 中写这样的一个接口</p><pre><code class="language-ts">function functionA(b: () =&gt; void, c: () =&gt; void) {
    b();
    c();
}
</code></pre><p>然后在 B 和 C 中写两个函数</p><pre><code class="language-ts">function functionB() {
    console.log(&#x27;b&#x27;);
}
</code></pre><pre><code class="language-ts">function functionC() {
    console.log(&#x27;c&#x27;);
}
</code></pre><p>然后在 D 中组装，添加 A，B，C 三个 Git 仓库做为依赖，并调用 functionA：</p><pre><code class="language-ts">const functionA = require(&#x27;A&#x27;);
const functionB = require(&#x27;B&#x27;);
const functionC = require(&#x27;C&#x27;);

function functionD() {
    functionA(functionB, functionC);
}
</code></pre><h2 id="运行时：组合对象">运行时：组合对象</h2><p>以 TypeScript 示例。</p><p>我们可以在 A 中写这样的一个接口</p><pre><code class="language-ts">function functionA(b: { doSomething(): void; }, c: { doSomething(): void; }) {
    b.doSomething();
    c.doSomething();
}
</code></pre><p>然后在 B 和 C 中写两个对象</p><pre><code class="language-ts">const b = {
    doSomething: function() {
        console.log(&#x27;b&#x27;);
    }
}
</code></pre><pre><code class="language-ts">const c = {
    doSomething: function() {
        console.log(&#x27;c&#x27;);
    }
}
</code></pre><p>然后在 D 中组装，添加 A，B，C 三个 Git 仓库做为依赖，并调用 functionA：</p><pre><code class="language-ts">const functionA = require(&#x27;A&#x27;);
const b = require(&#x27;B&#x27;);
const c = require(&#x27;C&#x27;);

function functionD() {
    functionA(b, c);
}
</code></pre><h2 id="编译时：模板">编译时：模板</h2><p>以 C++ 为例。</p><p>我们可以在 A 中写这样的一个接口</p><pre><code class="language-c++">template&lt;typename TB, typename TC&gt;
void functionA() {
    TB::doSomething();
    TC::doSomething();
}
</code></pre><p>然后在 B 和 C 中写两个类</p><pre><code class="language-c++">#include &lt;iostream&gt;

class ClassB {
public:
    static void doSomething() {
        std::cout &lt;&lt; &#x27;b&#x27; &lt;&lt; std::endl;
    }
};
</code></pre><pre><code class="language-c++">#include &lt;iostream&gt;

class ClassC {
public:
    static void doSomething() {
        std::cout &lt;&lt; &#x27;c&#x27; &lt;&lt; std::endl;
    }
};
</code></pre><p>然后在 D 中组装，添加 A，B，C 三个 Git 仓库做为依赖，并调用 functionA：</p><pre><code class="language-ts">#include &quot;A.hpp&quot;
#include &quot;B.hpp&quot;
#include &quot;C.hpp&quot;

void functionD() {
    functionA&lt;ClassB, ClassC&gt;();
}
</code></pre><h2 id="编译时：函数替换">编译时：函数替换</h2><p>以 TypeScript 为例</p><p>我们可以在 A 中写这样的一个接口</p><pre><code class="language-ts">class A {
    public a() {
        this.b();
        this.c();
    }
    public b() {
        throw new Error(&#x27;not implemented&#x27;);
    }
    public c() {
        throw new Error(&#x27;not implemented&#x27;);
    }
}
</code></pre><p>然后在 B 和 C 的 Git 仓库中“覆盖” ClassA 的实现</p><pre><code class="language-ts">// 在同样的文件夹和文件名中定义
class A {
    @override
    public b() {
        console.log(&#x27;b&#x27;);
    }
}
</code></pre><pre><code class="language-ts">// 在同样的文件夹和文件名中定义
class A {
    @override
    public c() {
        console.log(&#x27;c&#x27;);
    }
}
</code></pre><p>然后在 D 中组装，添加 A，B，C 三个 Git 仓库做为依赖:</p><pre><code class="language-json">{
    &quot;name&quot;: &quot;@someOrg/D&quot;,
    &quot;version&quot;: &quot;0.0.1&quot;,
    &quot;dependencies&quot;: {
        &quot;@someOrg/A&quot;: &quot;0.0.1&quot;,
        &quot;@someOrg/B&quot;: &quot;0.0.1&quot;,
        &quot;@someOrg/C&quot;: &quot;0.0.1&quot;
    }
}
</code></pre><p>然后需要用编译工具，在编译 D 的时候，因为 B/C 中的 ClassA 与 A中的 ClassA 同文件夹且同文件名，替换 ClassA 中的函数。
这样就达到了和 C++ 模板类似的效果。</p><h2 id="运行时：vue-插槽">运行时：Vue 插槽</h2><p>Vue 的插槽和 TypeScript 函数组合是类似的。</p><p>我们可以在 A 中写这样的一个接口</p><pre><code class="language-html">&lt;!-- A.vue --&gt;
&lt;div class=&quot;container&quot;&gt;
  &lt;header&gt;
    &lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;
  &lt;/header&gt;
  &lt;footer&gt;
    &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;
  &lt;/footer&gt;
&lt;/div&gt;
</code></pre><p>然后在 B 和 C 中写两个组件</p><pre><code class="language-html">&lt;!-- B.vue --&gt;
&lt;div&gt;b&lt;/div&gt;
</code></pre><pre><code class="language-html">&lt;!-- C.vue --&gt;
&lt;div&gt;c&lt;/div&gt;
</code></pre><p>然后在 D 中组装，添加 A，B，C 三个 Git 仓库做为依赖，调用 A 组件:</p><pre><code class="language-html">&lt;A&gt;
    &lt;template #header&gt;
        &lt;B/&gt;
    &lt;/template&gt;
    &lt;template #footer&gt;
        &lt;C/&gt;
    &lt;/template&gt;
&lt;/A&gt;
</code></pre><h2 id="编译时：页面模板替换">编译时：页面模板替换</h2><p>和函数替换一样，也可以对页面模板做替换。</p><p>我们可以在 A 中写这样的一个接口</p><pre><code class="language-html">&lt;!-- A.tm --&gt;
&lt;template #default&gt;
    &lt;div class=&quot;container&quot;&gt;
    &lt;header&gt;
        &lt;B/&gt;
    &lt;/header&gt;
    &lt;footer&gt;
        &lt;C/&gt;
    &lt;/footer&gt;
    &lt;/div&gt;
&lt;/template&gt;
&lt;template #B&gt;
&lt;/template&gt;
&lt;template #C&gt;
&lt;/template&gt;
</code></pre><p>然后在 B 和 C 中覆盖 A.tm 页面模板中的子模板</p><pre><code class="language-html">&lt;!-- 在同样的文件夹和文件名中定义 --&gt;
&lt;override #B&gt;
    &lt;div&gt;b&lt;/div&gt;
&lt;/override&gt;
</code></pre><pre><code class="language-html">&lt;!-- 在同样的文件夹和文件名中定义 --&gt;
&lt;override #C&gt;
    &lt;div&gt;c&lt;/div&gt;
&lt;/override&gt;
</code></pre><p>然后在 D 中组装，添加 A，B，C 三个 Git 仓库做为依赖:</p><pre><code class="language-json">{
    &quot;name&quot;: &quot;@someOrg/D&quot;,
    &quot;version&quot;: &quot;0.0.1&quot;,
    &quot;dependencies&quot;: {
        &quot;@someOrg/A&quot;: &quot;0.0.1&quot;,
        &quot;@someOrg/B&quot;: &quot;0.0.1&quot;,
        &quot;@someOrg/C&quot;: &quot;0.0.1&quot;
    }
}
</code></pre><p>然后需要用编译工具，在编译 D 的时候，因为 B/C 中的 A.tm 与 A中的 A.tm 同文件夹且同文件名，替换 A.tm 中的子模板。
这样就达到了和 C++ 模板类似的效果。</p><h1 id="显式组合与隐式组合">显式组合与隐式组合</h1><p>显式组合需要在代码中定义新的函数或者类，由新定义的函数或者类来组装原有的东西。例如</p><pre><code class="language-ts">const functionA = require(&#x27;A&#x27;);
const functionB = require(&#x27;B&#x27;);
const functionC = require(&#x27;C&#x27;);

function functionD() {
    functionA(functionB, functionC);
}
</code></pre><p>优点是组装非常灵活，可以表达任意复杂的逻辑。缺点是组装非常灵活，导致实际运行时的装配关系很难阅读代码得知。</p><p>隐式组合是指：</p><pre><code class="language-json">{
    &quot;name&quot;: &quot;@someOrg/D&quot;,
    &quot;version&quot;: &quot;0.0.1&quot;,
    &quot;dependencies&quot;: {
        &quot;@someOrg/A&quot;: &quot;0.0.1&quot;,
        &quot;@someOrg/B&quot;: &quot;0.0.1&quot;,
        &quot;@someOrg/C&quot;: &quot;0.0.1&quot;
    }
}
</code></pre><p>仅仅声明 Git 仓库之间的依赖关系。由编译工具，根据同文件夹，同文件名做函数和模板替换。这样的隐式组合缺点是依赖特殊编译工具链，好处是搞不出花样，仅仅实现了依赖倒置的目的，而不具有二次动态装配的能力（以及随之而来的理解成本）。</p></div><a aria-current="page" class="obstructed-label" href="/modularization_examples/public/142388d4e5a02585151e424aef5c7488/README">装配逻辑</a></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/public/142388d4e5a02585151e424aef5c7488/README";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-26e6b42c58a5586028fc.js"],"app":["/app-3ebb7bf766e9c9328de5.js"],"component---node-modules-gatsby-theme-gardenx-src-templates-local-file-js":["/component---node-modules-gatsby-theme-gardenx-src-templates-local-file-js-dcc791b43f566c1a08be.js"]};/*]]>*/</script><script src="/modularization_examples/polyfill-26e6b42c58a5586028fc.js" nomodule=""></script><script src="/modularization_examples/webpack-runtime-6966da674d0f80bafab7.js" async=""></script><script src="/modularization_examples/framework-e87d450386191ab2f570.js" async=""></script><script src="/modularization_examples/app-3ebb7bf766e9c9328de5.js" async=""></script><script src="/modularization_examples/styles-407fe62976dc5310c43e.js" async=""></script><script src="/modularization_examples/component---node-modules-gatsby-theme-gardenx-src-templates-local-file-js-dcc791b43f566c1a08be.js" async=""></script></body></html>